<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Option Simulator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #container {
            display: flex;
            width: 90%;
            max-width: 1200px;
        }
        #input-section {
            flex: 1;
            padding: 20px;
            border-right: 1px solid #ddd;
        }
        #chart-section {
            flex: 2;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .input-group {
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }
        .input-group label {
            flex: 1;
        }
        .input-group input, .input-group select {
            flex: 2;
        }
        #chartCanvas {
            width: 100%;
            max-height: 500px;
        }
        #results {
            margin-top: 20px;
            text-align: center;
        }
        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Stock Option Simulator</h1>
    <div id="container">
        <div id="input-section">
            <div class="input-group">
                <label for="s0">Initial Stock Price (S0):</label>
                <input type="number" id="s0" value="36">
            </div>
            <div class="input-group">
                <label for="k">Strike Price (K):</label>
                <input type="number" id="k" value="40">
            </div>
            <div class="input-group">
                <label for="t">Time to Expiration (T):</label>
                <input type="number" id="t" value="1.0">
            </div>
            <div class="input-group">
                <label for="r">Risk-free Rate (r):</label>
                <input type="number" id="r" value="0.06">
            </div>
            <div class="input-group">
                <label for="sigma">Volatility (sigma):</label>
                <input type="number" id="sigma" value="0.2">
            </div>
            <div class="input-group">
                <label for="paths">Number of Paths:</label>
                <input type="number" id="paths" value="500">
            </div>
            <div class="input-group">
                <label for="steps">Number of Steps:</label>
                <input type="number" id="steps" value="252">
            </div>
            <div class="input-group">
                <label for="optionType">Option Type:</label>
                <select id="optionType">
                    <option value="call">Call</option>
                    <option value="put">Put</option>
                </select>
            </div>
            <div class="input-group">
                <button id="simulateButton">Simulate</button>
                <label><input type="checkbox" id="showMean" checked> Show Mean Path</label>
            </div>
        </div>
        <div id="chart-section">
            <canvas id="chartCanvas"></canvas>
            <div id="results"></div>
        </div>
    </div>

    <script>
        document.getElementById('simulateButton').addEventListener('click', simulateAndValue);

        function simulateAndValue() {
            const s0 = parseFloat(document.getElementById('s0').value);
            const k = parseFloat(document.getElementById('k').value);
            const t = parseFloat(document.getElementById('t').value);
            const r = parseFloat(document.getElementById('r').value);
            const sigma = parseFloat(document.getElementById('sigma').value);
            const paths = parseInt(document.getElementById('paths').value);
            const steps = parseInt(document.getElementById('steps').value);
            const optionType = document.getElementById('optionType').value;
            const showMean = document.getElementById('showMean').checked;

            if (isNaN(s0) || isNaN(k) || isNaN(t) || isNaN(r) || isNaN(sigma) || isNaN(paths) || isNaN(steps)) {
                alert("Please enter valid numerical inputs.");
                return;
            }

            const dt = t / steps;
            const stockPaths = simulateStockPaths(s0, r, sigma, dt, paths, steps);
            const optionPriceData = calculateOptionPrice(stockPaths, k, r, dt, optionType);
            displayResults(optionPriceData.price, optionPriceData.confidenceInterval);
            visualizePaths(stockPaths, showMean, s0);
        }

        function simulateStockPaths(s0, r, sigma, dt, paths, steps) {
            const stockPaths =;
            for (let i = 0; i < paths; i++) {
                const path = [s0];
                let currentPrice = s0;
                for (let j = 0; j < steps; j++) {
                    const z = (Math.random() * 2 - 1) + (Math.random() * 2 - 1) + (Math.random() * 2 - 1);
                    currentPrice *= Math.exp((r - 0.5 * sigma * sigma) * dt + sigma * Math.sqrt(dt) * z);
                    path.push(currentPrice);
                }
                stockPaths.push(path);
            }
            return stockPaths;
        }

        function calculateOptionPrice(stockPaths, k, r, dt, optionType) {
            const payoffs =;
            for (const path of stockPaths) {
                const finalPrice = path[path.length - 1];
                let payoff = 0;
                if (optionType === 'call') {
                    payoff = Math.max(finalPrice - k, 0);
                } else {
                    payoff = Math.max(k - finalPrice, 0);
                }
                payoffs.push(payoff);
            }
            const discountedPayoffs = payoffs.map(payoff => payoff * Math.exp(-r * stockPaths[0].length * dt)); // Corrected line: removed extra semicolon
            const averagePrice = discountedPayoffs.reduce((a, b) => a + b, 0) / discountedPayoffs.length;
            const stdDev = Math.sqrt(discountedPayoffs.map(x => Math.pow(x - averagePrice, 2)).reduce((a, b) => a + b, 0) / discountedPayoffs.length);
            const marginOfError = 1.96 * stdDev / Math.sqrt(discountedPayoffs.length);
            return {
                price: averagePrice,
                confidenceInterval: [averagePrice - marginOfError, averagePrice + marginOfError]
            };
        }

        function displayResults(price, confidenceInterval) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <p>Option Price: ${price.toFixed(2)}</p>
                <p>95% Confidence Interval: [${confidenceInterval[0].toFixed(2)}, ${confidenceInterval[1].toFixed(2)}]</p>
                <p>Simulation Method: Geometric Brownian Motion.</p>
                <p>Option Pricing: Monte Carlo Simulation.</p>
            `;
        }

        function visualizePaths(stockPaths, showMean) {
            const ctx = document.getElementById('chartCanvas').getContext('2d');
            let chart = Chart.getChart("chartCanvas");
            if (chart) {
                chart.destroy();
            }
            const labels = Array.from({ length: stockPaths[0].length }, (_, i) => i);
            const datasets =;

            if (showMean){
                const meanPath = stockPaths.reduce((acc, path) => acc.map((val, i) => (val || 0) + path[i]),).map(val => val / stockPaths.length);

                datasets.push({
                    label: 'Mean Path',
                    data: meanPath,
                    borderColor: 'red',
                    fill: false,
                    borderWidth: 2,
                });
            }

            // Limit to 50 paths if not showing mean
            const maxPathsToShow = showMean ? stockPaths.length : 50; 
            for (let i = 0; i < maxPathsToShow; i++) {
                datasets.push({
                    label: `Path ${i + 1}`,
                    data: stockPaths[i],
                    borderColor: 'rgba(0, 0, 0, 0.1)',
                    fill: false,
                    borderWidth: 1,
                    pointRadius: 0,
                });
            }

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets 
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: false
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>