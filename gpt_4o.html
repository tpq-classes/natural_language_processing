<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Price Simulation & Option Valuation</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 0;
            text-align: center;
        }
        .container {
            max-width: 800px;
            margin: auto;
        }
        input, select, button {
            margin: 5px;
            padding: 8px;
        }
        canvas {
            max-width: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Stock Price Simulation & European Option Pricing</h2>
        <label>Initial Stock Price (S0): <input type="number" id="S0" value="36"></label>
        <label>Strike Price (K): <input type="number" id="K" value="40"></label>
        <label>Time to Expiration (T in years): <input type="number" step="0.01" id="T" value="1.0"></label>
        <label>Risk-free Rate (r): <input type="number" step="0.01" id="r" value="0.06"></label>
        <label>Volatility (σ): <input type="number" step="0.01" id="sigma" value="0.2"></label>
        <label>Number of Paths: <input type="number" id="paths" value="500"></label>
        <label>Number of Steps: <input type="number" id="steps" value="252"></label>
        <label>Option Type: 
            <select id="optionType">
                <option value="call">Call</option>
                <option value="put">Put</option>
            </select>
        </label>
        <button onclick="simulateAndPrice()">Simulate</button>
        <p id="optionPrice"></p>
        <canvas id="stockChart"></canvas>
        <p><strong>Methodology:</strong> This simulation uses geometric Brownian motion to model stock prices and Monte Carlo methods to estimate European option prices.</p>
    </div>
    <script>
        function simulateAndPrice() {
            const S0 = parseFloat(document.getElementById('S0').value);
            const K = parseFloat(document.getElementById('K').value);
            const T = parseFloat(document.getElementById('T').value);
            const r = parseFloat(document.getElementById('r').value);
            const sigma = parseFloat(document.getElementById('sigma').value);
            const paths = parseInt(document.getElementById('paths').value);
            const steps = parseInt(document.getElementById('steps').value);
            const optionType = document.getElementById('optionType').value;
            
            const dt = T / steps;
            const stockPaths = [];
            let optionPayoffs = [];
            
            for (let i = 0; i < paths; i++) {
                let path = [S0];
                let S = S0;
                for (let j = 0; j < steps; j++) {
                    let dW = Math.sqrt(dt) * randomNormal();
                    S *= Math.exp((r - 0.5 * sigma ** 2) * dt + sigma * dW);
                    path.push(S);
                }
                stockPaths.push(path);
                optionPayoffs.push(optionType === 'call' ? Math.max(S - K, 0) : Math.max(K - S, 0));
            }
            
            const discountFactor = Math.exp(-r * T);
            const optionPrice = discountFactor * optionPayoffs.reduce((a, b) => a + b, 0) / paths;
            const stdDev = Math.sqrt(optionPayoffs.map(x => (x - optionPrice) ** 2).reduce((a, b) => a + b, 0) / paths);
            const confInterval = 1.96 * stdDev / Math.sqrt(paths);
            
            document.getElementById('optionPrice').innerText = `Estimated ${optionType.toUpperCase()} Option Price: ${optionPrice.toFixed(4)} ± ${confInterval.toFixed(4)}`;
            plotPaths(stockPaths);
        }
        
        function randomNormal() {
            let u = 1 - Math.random();
            let v = 1 - Math.random();
            return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
        }
        
        function plotPaths(stockPaths) {
            const ctx = document.getElementById('stockChart').getContext('2d');
            if (window.stockChartInstance) {
                window.stockChartInstance.destroy();
            }
            let datasets = stockPaths.slice(0, 10).map(path => ({
                label: 'Stock Path',
                data: path,
                borderColor: `rgba(0, 0, 255, 0.2)`,
                borderWidth: 1,
                fill: false,
                pointRadius: 0
            }));
            
            const meanPath = stockPaths[0].map((_, i) => stockPaths.reduce((sum, path) => sum + path[i], 0) / stockPaths.length);
            datasets.push({
                label: 'Mean Path',
                data: meanPath,
                borderColor: 'red',
                borderWidth: 2,
                fill: false
            });
            
            window.stockChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({ length: stockPaths[0].length }, (_, i) => i),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }
    </script>
</body>
</html>
