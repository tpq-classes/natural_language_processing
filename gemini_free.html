<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Black-Scholes Option Pricer</title>
    <style>
        /* ... (CSS styles remain the same) ... */
    </style>
</head>
<body>
    <div class="container">
        <h1>Black-Scholes Option Pricer</h1>

        <form id="optionForm">
            <label for="S0">Underlying Price (S0):</label>
            <input type="number" id="S0" value="36">

            <label for="K">Strike Price (K):</label>
            <input type="number" id="K" value="40">

            <label for="T">Time to Expiration (T):</label>
            <input type="number" id="T" value="1.0">

            <label for="r">Risk-Free Rate (r):</label>
            <input type="number" id="r" value="0.06">

            <label for="sigma">Volatility (sigma):</label>
            <input type="number" id="sigma" value="0.2">

            <label for="optionType">Option Type:</label>
            <select id="optionType">
                <option value="call">Call</option>
                <option value="put">Put</option>
            </select>

            <button type="button" onclick="calculate()">Calculate</button>
        </form>

        <div id="result"></div>
        <div id="error" class="error"></div>

        <div class="explanation">
            <h2>Black-Scholes Model Explanation</h2>
            <p>The Black-Scholes model is a mathematical model used to determine the theoretical price of European-style options. It assumes that the price of the underlying asset follows a geometric Brownian motion with constant volatility and risk-free interest rate.  It's a simplified model and doesn't account for factors like dividends or early exercise.</p>
        </div>

    </div>

    <script>
        const cache = {};

        function calculate() {
            const S0 = parseFloat(document.getElementById("S0").value);
            const K = parseFloat(document.getElementById("K").value);
            const T = parseFloat(document.getElementById("T").value);
            const r = parseFloat(document.getElementById("r").value);
            const sigma = parseFloat(document.getElementById("sigma").value);
            const optionType = document.getElementById("optionType").value;
            const errorDiv = document.getElementById("error");
            errorDiv.textContent = "";

            if (isNaN(S0) || isNaN(K) || isNaN(T) || isNaN(r) || isNaN(sigma) || S0 <= 0 || K <= 0 || T <= 0 || sigma <= 0) {
                errorDiv.textContent = "Please enter valid positive numbers for all inputs.";
                return;
            }

            const key = `${S0}-${K}-${T}-${r}-${sigma}-${optionType}`;
            if (cache[key]) {
                displayResult(cache[key]);
                return;
            }

            const result = blackScholes(S0, K, T, r, sigma, optionType);
            cache[key] = result;
            displayResult(result);
        }

        function blackScholes(S0, K, T, r, sigma, optionType) {
            const d1 = (Math.log(S0 / K) + (r + 0.5 * sigma * sigma) * T) / (sigma * Math.sqrt(T));
            const d2 = d1 - sigma * Math.sqrt(T);

            const N_d1 = cnd(d1);
            const N_d2 = cnd(d2);

            let price, delta, gamma, theta, vega;

            if (optionType === "call") {
                price = S0 * N_d1 - K * Math.exp(-r * T) * N_d2;
                delta = N_d1;
                gamma = (Math.exp(-d1 * d1 / 2) / Math.sqrt(2 * Math.PI)) / (S0 * sigma * Math.sqrt(T));
                theta = -(S0 * sigma * Math.exp(-d1 * d1 / 2) / (2 * Math.sqrt(2 * Math.PI * T))) - r * K * Math.exp(-r * T) * N_d2;
                vega = S0 * Math.sqrt(T) * (Math.exp(-d1 * d1 / 2) / Math.sqrt(2 * Math.PI));
            } else { // Put
                price = K * Math.exp(-r * T) * (1 - N_d2) - S0 * (1 - N_d1);
                delta = N_d1 - 1; // Corrected delta for put
                gamma = (Math.exp(-d1 * d1 / 2) / Math.sqrt(2 * Math.PI)) / (S0 * sigma * Math.sqrt(T));
                theta = -(S0 * sigma * Math.exp(-d1 * d1 / 2) / (2 * Math.sqrt(2 * Math.PI * T))) + r * K * Math.exp(-r * T) * (1 - N_d2);
                vega = S0 * Math.sqrt(T) * (Math.exp(-d1 * d1 / 2) / Math.sqrt(2 * Math.PI));
            }

            return { price, delta, gamma, theta, vega };
        }


        // Improved Cumulative Normal Distribution Function
        function cnd(x) {
            const a1 = 0.319381530;
            const a2 = -0.356563782;
            const a3 = 1.781477937;
            const a4 = -1.821255978;
            const a5 = 1.330274429;

            const L = Math.abs(x);
            const k = 1 / (1 + 0.2316419 * L);

            let cnd = 1 - (a1 * k + a2 * k*k + a3 * Math.pow(k,3) + a4 * Math.pow(k,4) + a5 * Math.pow(k,5)) * Math.exp(-L*L/2) / Math.sqrt(2*Math.PI);

            if (x >= 0) {
                return cnd;
            } else {
                return 1 - cnd;
            }
        }


        function displayResult(result) {
            const resultDiv = document.getElementById("result");
            resultDiv.innerHTML = `
                <p><strong>Price:</strong> ${result.price.toFixed(4)}</p>
                <p><strong>Delta:</strong> ${result.delta.toFixed(4)}</p>
                <p><strong>Gamma:</strong> ${result.gamma.toFixed(4)}</p>
                <p><strong>Theta:</strong> ${result.theta.toFixed(4)}</p>
                <p><strong>Vega:</strong> ${result.vega.toFixed(4)}</p>
            `;
        }
    </script>

</body>
</html>